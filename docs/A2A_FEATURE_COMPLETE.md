# A2A åŠŸèƒ½è¡¥é½å®ŒæˆæŠ¥å‘Š

## ğŸ“‹ æ¦‚è¿°

æ ¹æ® `A2A_CORE_COMPARISON.md` çš„å¯¹æ¯”åˆ†æï¼ŒJava ç‰ˆæœ¬ç°å·²è¡¥é½æ‰€æœ‰ Python ç‰ˆæœ¬çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œå®ç°äº†ä¸ Python ç‰ˆæœ¬çš„ A2A æœºåˆ¶åŠŸèƒ½å¯¹é½ã€‚

---

## âœ… å·²è¡¥é½çš„åŠŸèƒ½æ¸…å•

### 1. **è°ƒç”¨æ ˆè¿½è¸ª** âœ…

**å®ç°ä½ç½®**: `framework/model/AgentRequest.java`

**æ–°å¢å­—æ®µ**:
- `callStack`: è°ƒç”¨æ ˆè·¯å¾„åˆ—è¡¨
- `nodeIdStack`: èŠ‚ç‚¹IDæ ˆ
- `nodeId`: å½“å‰èŠ‚ç‚¹ID
- `fatherNodeId`: çˆ¶èŠ‚ç‚¹ID
- `preNodeIds`: å‰ç½®èŠ‚ç‚¹IDåˆ—è¡¨
- `latestNodeIds`: æœ€æ–°èŠ‚ç‚¹IDåˆ—è¡¨
- `parallelId`: å¹¶è¡Œæ‰§è¡ŒID
- `parallelDict`: å¹¶è¡Œæ‰§è¡Œå­—å…¸

**åŠŸèƒ½**: å®Œæ•´çš„è°ƒç”¨é“¾è¿½è¸ªï¼Œæ”¯æŒè°ƒè¯•å’Œç›‘æ§ã€‚

---

### 2. **ä¸Šä¸‹æ–‡ç®¡ç†** âœ…

**å®ç°ä½ç½®**: `framework/model/AgentRequest.java`

**æ–°å¢å­—æ®µ**:
- `sharedData`: è¯·æ±‚çº§å…±äº«æ•°æ®ï¼ˆåŒtraceå†…å…±äº«ï¼‰
- `groupData`: ä¼šè¯çº§å…±äº«æ•°æ®ï¼ˆåŒgroupå†…å…±äº«ï¼‰

**åŠŸèƒ½**: å¤šå±‚çº§æ•°æ®å…±äº«æœºåˆ¶ï¼Œæ”¯æŒèŠ‚ç‚¹çº§ã€è¯·æ±‚çº§ã€ä¼šè¯çº§çš„æ•°æ®éš”ç¦»å’Œå…±äº«ã€‚

**å®ç°ç»†èŠ‚**:
- `cloneWith()` æ–¹æ³•ä¸­ï¼Œ`sharedData` å’Œ `groupData` é€šè¿‡å¼•ç”¨å…±äº«ï¼ˆè€Œéæ·±æ‹·è´ï¼‰
- ç¡®ä¿åŒä¸€è¯·æ±‚æˆ–ä¼šè¯ä¸­çš„æ™ºèƒ½ä½“å¯ä»¥å…±äº«æ•°æ®

---

### 3. **è¯·æ±‚å¯¹è±¡è°ƒç”¨æ¨¡å¼** âœ…

**å®ç°ä½ç½®**: `framework/model/AgentRequest.java`

**æ–°å¢æ–¹æ³•**:
- `call(String callee, Map<String, Object> arguments)`: è°ƒç”¨å…¶ä»–æ™ºèƒ½ä½“æˆ–å·¥å…·
- `cloneWith(String callee, Map<String, Object> newArguments)`: å…‹éš†è¯·æ±‚å¯¹è±¡

**åŠŸèƒ½**: æ”¯æŒé€šè¿‡è¯·æ±‚å¯¹è±¡ç›´æ¥è°ƒç”¨å…¶ä»–æ™ºèƒ½ä½“ï¼Œè‡ªåŠ¨å¤„ç†ä¸Šä¸‹æ–‡ä¼ é€’ã€è°ƒç”¨æ ˆæ›´æ–°ç­‰ã€‚

**ä½¿ç”¨ç¤ºä¾‹**:
```java
// åœ¨æ™ºèƒ½ä½“ä¸­è°ƒç”¨å…¶ä»–æ™ºèƒ½ä½“
AgentResponse response = request.call("agent_b", Map.of("query", "æ‰§è¡Œä»»åŠ¡")).join();
```

---

### 4. **æƒé™æ ¡éªŒ** âœ…

**å®ç°ä½ç½®**: 
- `framework/agent/Agent.java`: æ·»åŠ æƒé™ç›¸å…³æ¥å£æ–¹æ³•
- `framework/model/AgentRequest.java`: `call()` æ–¹æ³•ä¸­å®ç°æƒé™æ ¡éªŒé€»è¾‘

**æ–°å¢æ¥å£æ–¹æ³•**:
- `isPermissionRequired()`: æ˜¯å¦éœ€è¦æƒé™æ ¡éªŒ
- `getPermittedToolNameList()`: è·å–å…è®¸è°ƒç”¨çš„å·¥å…·/æ™ºèƒ½ä½“åˆ—è¡¨

**åŠŸèƒ½**: æ”¯æŒæƒé™æ ¡éªŒæœºåˆ¶ï¼Œé˜²æ­¢æœªæˆæƒè°ƒç”¨ã€‚

**å®ç°ç»†èŠ‚**:
- åœ¨ `AgentRequest.call()` æ–¹æ³•ä¸­ï¼Œå¦‚æœè°ƒç”¨è€…ä¸æ˜¯ç”¨æˆ·ï¼Œä¼šæ£€æŸ¥æƒé™
- å¦‚æœç›®æ ‡æ™ºèƒ½ä½“éœ€è¦æƒé™ï¼Œä¸”è°ƒç”¨è€…ä¸åœ¨å…è®¸åˆ—è¡¨ä¸­ï¼Œè¿”å› `AgentState.SKIPPED`

---

### 5. **è¶…æ—¶æ§åˆ¶** âœ…

**å®ç°ä½ç½®**: 
- `framework/agent/Agent.java`: æ·»åŠ  `getTimeout()` æ¥å£æ–¹æ³•
- `framework/model/AgentRequest.java`: `call()` æ–¹æ³•ä¸­ä½¿ç”¨ `CompletableFuture.orTimeout()` å®ç°è¶…æ—¶

**åŠŸèƒ½**: æ”¯æŒæ™ºèƒ½ä½“æ‰§è¡Œè¶…æ—¶æ§åˆ¶ã€‚

**å®ç°ç»†èŠ‚**:
- å¦‚æœæ™ºèƒ½ä½“çš„ `getTimeout()` è¿”å›å¤§äº 0 çš„å€¼ï¼Œä½¿ç”¨ `CompletableFuture.orTimeout()` è®¾ç½®è¶…æ—¶
- è¶…æ—¶åè¿”å› `AgentState.FAILED` çŠ¶æ€

---

### 6. **é‡è¯•æœºåˆ¶** âœ…

**å®ç°ä½ç½®**: 
- `framework/agent/Agent.java`: æ·»åŠ  `getRetries()` å’Œ `getDelay()` æ¥å£æ–¹æ³•
- `framework/agent/ReActAgent.java`: `executeToolCallWithRetry()` æ–¹æ³•å®ç°é‡è¯•é€»è¾‘

**åŠŸèƒ½**: æ”¯æŒæ™ºèƒ½ä½“è°ƒç”¨å¤±è´¥åçš„è‡ªåŠ¨é‡è¯•ã€‚

**å®ç°ç»†èŠ‚**:
- `executeToolCallWithRetry()` æ–¹æ³•æ ¹æ®æ™ºèƒ½ä½“çš„ `getRetries()` é…ç½®è¿›è¡Œé‡è¯•
- é‡è¯•é—´éš”ç”± `getDelay()` æ§åˆ¶
- æƒé™é—®é¢˜ï¼ˆ`AgentState.SKIPPED`ï¼‰ä¸é‡è¯•ï¼Œç›´æ¥è¿”å›

---

### 7. **çŠ¶æ€ç®¡ç†** âœ…

**å®ç°ä½ç½®**: 
- `framework/model/AgentState.java`: æ–°å¢çŠ¶æ€æšä¸¾
- `framework/model/AgentResponse.java`: æ·»åŠ çŠ¶æ€å­—æ®µ

**æ–°å¢æšä¸¾**:
- `CREATED`: å·²åˆ›å»º
- `RUNNING`: è¿è¡Œä¸­
- `COMPLETED`: å·²å®Œæˆ
- `FAILED`: å¤±è´¥
- `PAUSED`: æš‚åœ
- `SKIPPED`: è·³è¿‡ï¼ˆæƒé™ä¸è¶³ç­‰ï¼‰
- `CANCELED`: å–æ¶ˆ

**åŠŸèƒ½**: æ ‡å‡†åŒ–çš„æ‰§è¡ŒçŠ¶æ€ç®¡ç†ï¼Œå¯¹åº” Python ç‰ˆæœ¬çš„ `OxyState`ã€‚

---

### 8. **å“åº”å¯¹è±¡å¢å¼º** âœ…

**å®ç°ä½ç½®**: `framework/model/AgentResponse.java`

**æ–°å¢å­—æ®µ**:
- `state`: æ‰§è¡ŒçŠ¶æ€ï¼ˆ`AgentState`ï¼‰
- `extra`: é¢å¤–å…ƒæ•°æ®ï¼ˆtokenæ•°ã€è€—æ—¶ç­‰ï¼‰
- `request`: å…³è”çš„è¯·æ±‚å¯¹è±¡

**åŠŸèƒ½**: å®Œæ•´çš„å“åº”ä¿¡æ¯ï¼Œæ”¯æŒçŠ¶æ€æ£€æŸ¥å’Œå…ƒæ•°æ®æŸ¥è¯¢ã€‚

---

## ğŸ“Š åŠŸèƒ½å¯¹æ¯”è¡¨

| åŠŸèƒ½ | Python ç‰ˆæœ¬ | Java ç‰ˆæœ¬ | çŠ¶æ€ |
|------|------------|-----------|------|
| è°ƒç”¨æ ˆè¿½è¸ª | âœ… | âœ… | å·²å¯¹é½ |
| ä¸Šä¸‹æ–‡ç®¡ç† | âœ… | âœ… | å·²å¯¹é½ |
| è¯·æ±‚å¯¹è±¡è°ƒç”¨ | âœ… | âœ… | å·²å¯¹é½ |
| æƒé™æ ¡éªŒ | âœ… | âœ… | å·²å¯¹é½ |
| è¶…æ—¶æ§åˆ¶ | âœ… | âœ… | å·²å¯¹é½ |
| é‡è¯•æœºåˆ¶ | âœ… | âœ… | å·²å¯¹é½ |
| çŠ¶æ€ç®¡ç† | âœ… | âœ… | å·²å¯¹é½ |
| è¿œç¨‹è°ƒç”¨ | âœ… | âœ… | å·²å¯¹é½ |

---

## ğŸ¯ å®ç°äº®ç‚¹

1. **ä¿æŒå…¼å®¹æ€§**: æ‰€æœ‰æ–°åŠŸèƒ½éƒ½å‘åå…¼å®¹ï¼Œæ—§ä»£ç æ— éœ€ä¿®æ”¹å³å¯è¿è¡Œ
2. **Java ç‰¹æ€§**: å……åˆ†åˆ©ç”¨ Java è¯­è¨€ç‰¹æ€§ï¼ˆ`CompletableFuture`, `UUID`, `default` æ–¹æ³•ç­‰ï¼‰
3. **ç±»å‹å®‰å…¨**: ä½¿ç”¨æšä¸¾å’Œå¼ºç±»å‹ï¼Œæé«˜ä»£ç å®‰å…¨æ€§
4. **æ–‡æ¡£å®Œå–„**: æ‰€æœ‰æ–°å¢æ–¹æ³•éƒ½æœ‰è¯¦ç»†çš„ JavaDoc æ³¨é‡Š

---

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### ä½¿ç”¨æ–°çš„è°ƒç”¨æ–¹å¼

```java
// åœ¨æ™ºèƒ½ä½“ä¸­è°ƒç”¨å…¶ä»–æ™ºèƒ½ä½“ï¼ˆæ¨èæ–¹å¼ï¼‰
AgentResponse response = request.call("agent_b", Map.of("query", "æ‰§è¡Œä»»åŠ¡")).join();

// æ£€æŸ¥å“åº”çŠ¶æ€
if (response.getState() == AgentState.COMPLETED) {
    String output = response.getOutput();
    // å¤„ç†æˆåŠŸå“åº”
} else if (response.getState() == AgentState.SKIPPED) {
    // æƒé™ä¸è¶³
} else if (response.getState() == AgentState.FAILED) {
    // è°ƒç”¨å¤±è´¥
}
```

### ä½¿ç”¨å…±äº«æ•°æ®

```java
// è®¾ç½®å…±äº«æ•°æ®
request.getSharedData().put("key", "value");

// åœ¨å­æ™ºèƒ½ä½“ä¸­è®¿é—®å…±äº«æ•°æ®
String value = (String) request.getSharedData().get("key");
```

### æŸ¥çœ‹è°ƒç”¨æ ˆ

```java
// è·å–è°ƒç”¨æ ˆ
List<String> callStack = request.getCallStack();
// ä¾‹å¦‚: ["user", "master_agent", "sub_agent"]

// è·å–èŠ‚ç‚¹IDæ ˆ
List<String> nodeIdStack = request.getNodeIdStack();
```

---

## ğŸ”„ è¿ç§»æŒ‡å—

### ä»æ—§ç‰ˆæœ¬è¿ç§»

1. **AgentResponse æ„é€ **: 
   - æ—§: `new AgentResponse(output, success, history)`
   - æ–°: `new AgentResponse(AgentState.COMPLETED, output, extra, request)`

2. **æ™ºèƒ½ä½“è°ƒç”¨**:
   - æ—§: `framework.getAgent(name).execute(request).join()`
   - æ–°: `request.call(name, arguments).join()` (æ¨è)

3. **çŠ¶æ€æ£€æŸ¥**:
   - æ—§: `response.isSuccess()`
   - æ–°: `response.getState() == AgentState.COMPLETED`

---

## âœ… æ€»ç»“

Java ç‰ˆæœ¬çš„ A2A æœºåˆ¶ç°å·²ä¸ Python ç‰ˆæœ¬åŠŸèƒ½å¯¹é½ï¼Œæ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½éƒ½å·²å®ç°ã€‚ä¸¤ä¸ªç‰ˆæœ¬åœ¨åŠŸèƒ½ä¸Šä¿æŒä¸€è‡´ï¼ŒåŒæ—¶å……åˆ†åˆ©ç”¨å„è‡ªè¯­è¨€çš„ä¼˜åŠ¿ï¼Œæä¾›äº†å®Œå–„çš„æ™ºèƒ½ä½“é—´é€šä¿¡æœºåˆ¶ã€‚

